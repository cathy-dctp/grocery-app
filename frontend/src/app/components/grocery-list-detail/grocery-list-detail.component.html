<div class="grocery-list-detail">
  @if (list()) {
    <div class="header">
      <div class="list-info">
        <a [routerLink]="['/lists']" class="back-link">← Back to Lists</a>
        <h1>{{ list()!.name }}</h1>
        <p class="list-meta">Created {{ list()!.created_at | date }}</p>
      </div>
      <button class="add-item-btn" (click)="showAddForm()">+ Add Item</button>
    </div>

    @if (showAddItemForm) {
      <div class="add-item-form">
        <select [(ngModel)]="selectedItemId" class="item-select">
          <option value="0">Select an item</option>
          @for (item of availableItems(); track item.id) {
            <option [value]="item.id">{{ item.name }} ({{ item.category_name }})</option>
          }
        </select>
        
        <input 
          type="text" 
          [(ngModel)]="itemQuantity" 
          placeholder="Quantity" 
          class="quantity-input"
        >
        
        <input 
          type="text" 
          [(ngModel)]="itemUnit" 
          [placeholder]="getSelectedItemUnit() || 'Unit'"
          class="unit-input"
        >
        
        <button (click)="addItemToList()" [disabled]="!selectedItemId">Add</button>
        <button (click)="cancelAddItem()">Cancel</button>
      </div>
    }

    @if (loading()) {
      <div class="loading">Loading items...</div>
    } @else if (error()) {
      <div class="error">{{ error() }}</div>
    } @else {
      <div class="items-container">
        @for (item of items(); track item.id) {
          <div class="item-row" [class.checked]="item.is_checked">
            <div class="item-checkbox">
              <input 
                type="checkbox" 
                [checked]="item.is_checked"
                (change)="toggleItemChecked(item)"
              >
            </div>
            <div class="item-info">
              <span class="item-name">{{ item.item_name }}</span>
              <span class="item-details">{{ item.quantity }} {{ item.unit }}</span>
              <span class="item-category">{{ item.item_category_name }}</span>
            </div>
            <button 
              class="remove-btn" 
              (click)="removeItemFromList(item.id)"
              title="Remove from list"
            >
              ×
            </button>
          </div>
        } @empty {
          <div class="empty-state">
            <h3>No items in this list yet</h3>
            <p>Add some items to get started!</p>
          </div>
        }
      </div>
    }
  } @else {
    <div class="loading">Loading list...</div>
  }
</div>