<div class="bg-white rounded-2xl shadow-card p-6 animate-scale-in">
  <div class="flex items-center space-x-2 mb-6">
    <h2 class="text-xl font-heading font-semibold text-neutral-900">Add Item to List</h2>
  </div>

  <div class="space-y-6">
    <!-- Item Search -->
    <div>
      <label for="item-search" class="block text-sm font-medium text-neutral-700 mb-2 font-sans">
        Search or create item:
      </label>
      <app-item-autocomplete
        id="item-search"
        placeholder="Start typing to search items..."
        (itemSelected)="onItemSelected($event)"
        (createNewItem)="onCreateNewItem($event)"
      ></app-item-autocomplete>
    </div>

    @if (isCreatingNewItem()) {
    <!-- New Item Creation Form -->
    <div class="bg-secondary-50 border border-secondary-200 rounded-2xl p-6 animate-slide-up">
      <div class="flex items-center space-x-2 mb-4">
        <h3 class="text-lg font-heading font-medium text-secondary-800">
          Create New Item: "<span class="font-semibold">{{ newItemName() }}</span
          >"
        </h3>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2 font-sans">
            Category <span class="text-error-500">*</span>
          </label>
          <app-category-select
            [categories]="categories"
            [selectedCategoryId]="selectedCategoryId()"
            [required]="true"
            placeholder="Select a category"
            (categoryChanged)="onCategoryChanged($event)"
            (createNewCategory)="onCreateNewCategory($event)"
          ></app-category-select>
        </div>

        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2 font-sans">
            Default Unit <span class="text-error-500">*</span>
          </label>
          <select
            [(ngModel)]="newItemUnit"
            class="w-full px-4 py-3 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-secondary-500 focus:border-secondary-500 transition-colors duration-200 font-sans bg-white"
          >
            <option value="pcs">pieces</option>
            <option value="lb">pounds</option>
            <option value="kg">kilograms</option>
            <option value="bag">bag</option>
            <option value="box">box</option>
            <option value="bottle">bottle</option>
            <option value="can">can</option>
            <option value="gallon">gallon</option>
            <option value="dozen">dozen</option>
            <option value="bunch">bunch</option>
            <option value="container">container</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2 font-sans">
            Quantity
          </label>
          <input
            type="number"
            [(ngModel)]="itemQuantity"
            min="1"
            step="1"
            placeholder="1"
            class="w-full px-4 py-3 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-secondary-500 focus:border-secondary-500 transition-colors duration-200 font-sans bg-white"
          />
        </div>
      </div>

      <div class="flex flex-col sm:flex-row gap-3 mt-4">
        <button
          type="button"
          class="flex-1 inline-flex items-center justify-center px-6 py-3 bg-success-500 hover:bg-success-600 disabled:bg-success-300 text-white font-medium rounded-xl transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed font-heading"
          (click)="onSubmit()"
          [disabled]="!canSubmit()"
        >
          Create & Add to List
        </button>
        <button
          type="button"
          class="px-6 py-3 bg-neutral-100 hover:bg-neutral-200 text-neutral-700 font-medium rounded-xl transition-colors duration-200 font-heading"
          (click)="cancelNewItemCreation()"
        >
          Cancel
        </button>
      </div>
    </div>
    } @else if (selectedItem()) {
    <!-- Selected Item Display -->
    <div class="bg-primary-50 border border-primary-200 rounded-2xl p-4 animate-slide-up">
      <div class="flex items-center space-x-3">
        <svg class="h-5 w-5 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        <span class="text-sm font-medium text-primary-700 font-sans">Selected:</span>
        <span class="font-semibold text-primary-900 font-heading">{{ selectedItem()!.name }}</span>
        <span
          class="px-2 py-1 bg-secondary-100 text-secondary-700 rounded-full text-xs font-medium"
        >
          {{ selectedItem()!.category_name }}
        </span>
      </div>
    </div>

    <!-- Quantity and Unit -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label for="quantity" class="block text-sm font-medium text-neutral-700 mb-2 font-sans">
          Quantity:
        </label>
        <input
          id="quantity"
          type="text"
          [(ngModel)]="itemQuantity"
          placeholder="1"
          class="w-full px-4 py-3 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200 font-sans"
        />
      </div>

      <div>
        <label for="unit" class="block text-sm font-medium text-neutral-700 mb-2 font-sans">
          Unit:
        </label>
        <input
          id="unit"
          type="text"
          [(ngModel)]="itemUnit"
          [placeholder]="getSelectedItemUnit() || 'Unit'"
          class="w-full px-4 py-3 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200 font-sans"
        />
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row gap-3 pt-4">
      <button
        type="button"
        class="flex-1 inline-flex items-center justify-center px-8 py-3 bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white font-medium rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed font-heading"
        (click)="onSubmit()"
        [disabled]="!canSubmit()"
      >
        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 6v6m0 0v6m0-6h6m-6 0H6"
          />
        </svg>
        Add to List
      </button>
      <button
        type="button"
        class="px-6 py-3 bg-neutral-100 hover:bg-neutral-200 text-neutral-700 font-medium rounded-xl transition-colors duration-200 font-heading"
        (click)="onClear()"
      >
        Clear
      </button>
    </div>
    }
  </div>
</div>
